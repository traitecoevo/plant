<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Introduction to the plant model ‚Ä¢ plant</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<script src="../extra.js"></script><meta property="og:title" content="Introduction to the plant model">
<meta property="og:description" content="plant">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">plant</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">2.0.</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home"></span>
     
    Home
  </a>
</li>
<li>
  <a href="../articles/plant.html">
    <span class="fas fa-tree"></span>
     
    Getting Started
  </a>
</li>
<li>
  <a href="../reference/index.html">
    <span class="fas fa-list"></span>
     
    Reference
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fas fa-book"></span>
     
    Theory
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/demography.html">Demography of plants, patches, and metacommunities</a>
    </li>
    <li>
      <a href="../articles/physiology.html">The FF16 strategy</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fas fa-file-code-o"></span>
     
    Examples
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/individuals.html">Individual plants</a>
    </li>
    <li>
      <a href="../articles/patch.html">Patches of competing plants</a>
    </li>
    <li>
      <a href="../articles/equilibrium.html">Finding demographic equilibrium</a>
    </li>
    <li>
      <a href="../articles/emergent.html">Emergent properties of patches</a>
    </li>
    <li>
      <a href="../articles/fitness.html">Calculating fitness</a>
    </li>
    <li>
      <a href="../articles/cohort_spacing.html">The cohort spacing algorithm</a>
    </li>
    <li>
      <a href="../articles/parameters.html">Changing parameters</a>
    </li>
    <li>
      <a href="../articles/strategy.html">Implementing a new strategy</a>
    </li>
  </ul>
</li>
<li>
  <a href="../articles/developer_notes.html">
    <span class="fas fa-terminal"></span>
     
    Developer Notes
  </a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="../news/index.html">
    <span class="fas fa-newspaper-o"></span>
     
    News
  </a>
</li>
<li>
  <a href="https://github.com/traitecoevo/plant">
    <span class="fas fa-github fa-lg"></span>
     
    Github
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Introduction to the plant model</h1>
                        <h4 class="author">Daniel Falster</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/traitecoevo/plant/blob/master/vignettes/plant.Rmd"><code>vignettes/plant.Rmd</code></a></small>
      <div class="hidden name"><code>plant.Rmd</code></div>

    </div>

    
    
<div id="background" class="section level1">
<h1 class="hasAnchor">
<a href="#background" class="anchor"></a>Background</h1>
<p>This page contains a brief introduction to get you started with plant. More extensive information and tutorials are available, such as:</p>
<p><strong>Details of the modelling approaches:</strong></p>
<p><a href="https://traitecoevo.github.io/plant/articles/demography.html">Modelling demography of individuals, patches and metapopulations</a> <a href="https://traitecoevo.github.io/plant/articles/demography.html">The <code>FF16</code> physiological strategy model</a></p>
<p><strong>Details of using <code>plant</code> in R:</strong></p>
<p><a href="https://traitecoevo.github.io/plant/articles/individuals.html">Individual level properties</a> <a href="https://traitecoevo.github.io/plant/articles/cohort_spacing.html">The cohort spacing algorithm</a> <a href="https://traitecoevo.github.io/plant/articles/equilibrium.html">Finding demographic equilibrium</a> <a href="https://traitecoevo.github.io/plant/articles/patch.html">Patch level dynamics</a> <a href="https://traitecoevo.github.io/plant/articles/emergent.html">Patch level emergent properties</a> <a href="https://traitecoevo.github.io/plant/articles/fitness.html">Calculating fitness</a> <a href="https://traitecoevo.github.io/plant/articles/parameters.html">Modifying parameters of the physiological model</a> <a href="https://traitecoevo.github.io/plant/articles/strategy.html">Implementing a new strategy</a></p>
</div>
<div id="setup" class="section level1">
<h1 class="hasAnchor">
<a href="#setup" class="anchor"></a>Setup</h1>
<p>First, load plant:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/traitecoevo/plant">plant</a></span><span class="op">)</span></code></pre></div>
<p>For a full list of available functions run library(help=plant), or see the <a href="https://traitecoevo.github.io/plant/reference/index.html">online reference</a>.</p>
</div>
<div id="strategy-objects" class="section level1">
<h1 class="hasAnchor">
<a href="#strategy-objects" class="anchor"></a>Strategy objects</h1>
<p>Strategies are the corner stone of <code>plant</code>, describing the system of dynamical equations that determine processes such as growth, reproduction and mortality. The <code>plant</code> includes the <code>FF16</code> strategy for you to get started.</p>
<p>A strategy object holds two kinds of parameters, those that relate to physiological processes of the model and control parameters that are used by the <code>plant</code> solver. The physological parameters are strategy specific, oftend describing traits or rates of individuals and their effects on the environment, while control parameters are usually general to all <code>plant</code> models.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">s</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/FF16_Strategy.html">FF16_Strategy</a></span><span class="op">(</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">s</span><span class="op">)</span></code></pre></div>
<pre><code>## List of 32
##  $ lma                  : num 0.198
##  $ rho                  : num 608
##  $ hmat                 : num 16.6
##  $ omega                : num 3.8e-05
##  $ eta                  : num 12
##  $ theta                : num 0.000214
##  $ a_l1                 : num 5.44
##  $ a_l2                 : num 0.306
##  $ a_r1                 : num 0.07
##  $ a_b1                 : num 0.17
##  $ r_s                  : num 6.6
##  $ r_b                  : num 13.2
##  $ r_r                  : num 217
##  $ r_l                  : num 198
##  $ a_y                  : num 0.7
##  $ a_bio                : num 0.0245
##  $ k_l                  : num 0.457
##  $ k_b                  : num 0.2
##  $ k_s                  : num 0.2
##  $ k_r                  : num 1
##  $ a_p1                 : num 151
##  $ a_p2                 : num 0.205
##  $ a_f3                 : num 0.000114
##  $ a_f1                 : num 1
##  $ a_f2                 : num 50
##  $ S_D                  : num 0.25
##  $ a_d0                 : num 0.1
##  $ d_I                  : num 0.01
##  $ a_dG1                : num 5.5
##  $ a_dG2                : num 20
##  $ control              :List of 35
##   ..$ plant_assimilation_adaptive         : logi TRUE
##   ..$ plant_assimilation_over_distribution: logi FALSE
##   ..$ plant_assimilation_tol              : num 1e-06
##   ..$ plant_assimilation_iterations       : num 1000
##   ..$ plant_assimilation_rule             : num 21
##   ..$ plant_seed_tol                      : num 1e-08
##   ..$ plant_seed_iterations               : num 1000
##   ..$ cohort_gradient_eps                 : num 1e-06
##   ..$ cohort_gradient_direction           : int 1
##   ..$ cohort_gradient_richardson          : logi FALSE
##   ..$ cohort_gradient_richardson_depth    : num 4
##   ..$ environment_light_tol               : num 1e-06
##   ..$ environment_light_nbase             : num 17
##   ..$ environment_light_max_depth         : num 16
##   ..$ environment_rescale_usually         : logi FALSE
##   ..$ ode_step_size_initial               : num 1e-06
##   ..$ ode_step_size_min                   : num 1e-06
##   ..$ ode_step_size_max                   : num 0.1
##   ..$ ode_tol_rel                         : num 1e-06
##   ..$ ode_tol_abs                         : num 1e-06
##   ..$ ode_a_y                             : num 1
##   ..$ ode_a_dydt                          : num 0
##   ..$ schedule_nsteps                     : num 20
##   ..$ schedule_eps                        : num 0.001
##   ..$ schedule_verbose                    : logi FALSE
##   ..$ schedule_patch_survival             : num 6.25e-05
##   ..$ equilibrium_nsteps                  : num 20
##   ..$ equilibrium_eps                     : num 1e-05
##   ..$ equilibrium_large_seed_rain_change  : num 10
##   ..$ equilibrium_verbose                 : logi TRUE
##   ..$ equilibrium_solver_name             : chr "iteration"
##   ..$ equilibrium_extinct_seed_rain       : num 0.001
##   ..$ equilibrium_nattempts               : num 5
##   ..$ equilibrium_solver_logN             : logi TRUE
##   ..$ equilibrium_solver_try_keep         : logi TRUE
##   ..- attr(*, "class")= chr "Control"
##  $ collect_all_auxillary: logi FALSE
##  - attr(*, "class")= chr "FF16_Strategy"</code></pre>
</div>
<div id="individual-plants" class="section level1">
<h1 class="hasAnchor">
<a href="#individual-plants" class="anchor"></a>Individual plants</h1>
<p>We can define one or more individuals for a given strategy. These are accessed using the <code>Individual</code> class:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ind</span> <span class="op">=</span> <span class="fu"><a href="../reference/FF16_Individual.html">FF16_Individual</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>noting that <code>FF16_Individual</code> uses the <code>FF16_Strategy</code> by default (see <code><a href="../reference/FF16_Individual.html">?FF16_Individual</a></code> for more information).</p>
<p>We can see that our individual also shares the <code>FF16_Environment</code> (more on that soon) and a number of rates and functions for us to explore. The <a href="https://traitecoevo.github.io/plant/articles/individuals.html">Individuals vignette</a> describes the nuts and bolts of all these functions, for now we‚Äôre only going to grow and plot our individual‚Äôs height.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">ind</span><span class="op">)</span></code></pre></div>
<pre><code>## Classes 'Individual&lt;FF16,FF16_Env&gt;', 'Individual', 'R6' &lt;Individual&lt;FF16,FF16_Env&gt;&gt;
##   Inherits from: &lt;Individual&gt;
##   Public:
##     .ptr: externalptr
##     aux: function (name) 
##     aux_names: active binding
##     aux_size: active binding
##     clone: function (deep = FALSE) 
##     compute_competition: function (h) 
##     compute_rates: function (environment) 
##     establishment_probability: function (environment) 
##     initialize: function (ptr) 
##     internals: active binding
##     lcp_whole_plant: function () 
##     mortality_probability: active binding
##     net_mass_production_dt: function (environment) 
##     ode_names: active binding
##     ode_rates: active binding
##     ode_size: active binding
##     ode_state: active binding
##     rate: function (name) 
##     reset_mortality: function () 
##     set_state: function (name, v) 
##     state: function (name) 
##     strategy: active binding
##     strategy_name: active binding</code></pre>
<p>First we set a fixed environment (here <code>1.0</code> represents full light exposure in an open canopy) then use the <code>grow_plant_to_time</code> function to grow our individual for a range of time steps</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">env</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/FF16_Environment.html">FF16_fixed_environment</a></span><span class="op">(</span><span class="fl">1.0</span><span class="op">)</span>
<span class="va">times</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">50</span>, length.out <span class="op">=</span> <span class="fl">101</span><span class="op">)</span>
<span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/grow_plant_to_time.html">grow_plant_to_time</a></span><span class="op">(</span><span class="va">ind</span>, <span class="va">times</span>, <span class="va">env</span><span class="op">)</span></code></pre></div>
<p>Examining our result, we see a matrix of our state variables at each timestep</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">state</span><span class="op">)</span></code></pre></div>
<pre><code>##         height   mortality    fecundity area_heartwood mass_heartwood
## [1,] 0.3441948 0.000000000 0.000000e+00   0.000000e+00   0.000000e+00
## [2,] 0.5454996 0.005000003 7.685695e-22   6.109815e-09   1.525477e-06
## [3,] 0.8192984 0.010000006 7.231435e-21   3.084145e-08   1.092912e-05
## [4,] 1.1646766 0.015000010 6.354569e-20   1.146877e-07   5.694400e-05
## [5,] 1.5731336 0.020000016 5.663935e-19   3.542776e-07   2.372712e-04
## [6,] 2.0323819 0.025000025 5.101332e-18   9.417938e-07   8.167442e-04</code></pre>
<p>Which we can plot against time</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">times</span>, <span class="va">result</span><span class="op">$</span><span class="va">state</span><span class="op">[</span>,<span class="st">"height"</span><span class="op">]</span><span class="op">)</span></code></pre></div>
<p><img src="figure/plant__unnamed-chunk-7-1.png"></p>
</div>
<div id="patches" class="section level1">
<h1 class="hasAnchor">
<a href="#patches" class="anchor"></a>Patches</h1>
<p>While we can torture our individual into all sorts of shapes and sizes, it‚Äôs often more interesting to see how many individuals interact. <code>plant</code> describes groups of individuals as Cohorts that interact within a shared Patch. Cohorts are groups individuals of roughly the same age. As cohorts grow, they often alter their environment. In the <code>FF16</code> Strategy, individuals intercept light and shade other cohorts within the patch.</p>
<p>‚ÄúSolving‚Äù a Patch therefore means stepping cohorts through time, integrating the rate of change on individuals to describe their state (such as height) and integrating the impact their state has on other cohorts in a patch. While it‚Äôs possible to solve a Patch for very long time periods, in reality they are more likely to be disturbed and reset. By default <code>plant</code> starts with a bare Patch and introduces successive cohorts, stepping them through time, until the average disturbance related mortality has wiped the patch bare again.</p>
<p>First we load some parameters for our FF16 Strategy and set the mean disturbance interval</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">params</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/scm_base_parameters.html">scm_base_parameters</a></span><span class="op">(</span><span class="st">"FF16"</span><span class="op">)</span>
<span class="va">params</span><span class="op">$</span><span class="va">disturbance_mean_interval</span> <span class="op">&lt;-</span> <span class="fl">30.0</span></code></pre></div>
<p>Then we load a patch by applying those parameters to a FF16 Species with a leaf mass area of 0.0825 (admittedly this could be simpler, but the <a href="https://traitecoevo.github.io/plant/articles/patch.html">Patch vignette</a> explains what is going on)</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">patch</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/expand_parameters.html">expand_parameters</a></span><span class="op">(</span><span class="fu"><a href="../reference/trait_matrix.html">trait_matrix</a></span><span class="op">(</span><span class="fl">0.0825</span>, <span class="st">"lma"</span><span class="op">)</span>, <span class="va">params</span>, mutant <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<p>Then we run <code>plant</code> solver (SCM) to step the patch through time</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_scm_collect.html">run_scm_collect</a></span><span class="op">(</span><span class="va">patch</span><span class="op">)</span></code></pre></div>
<p>If you‚Äôre working through this yourself, the SCM solver should be blazingly fast. Our results contain the timesteps the patch was solved at, the species in the patch, the environment at each timestep, <code>p</code> the patch parameters, and two entries related to the metapopulation of patches: seed rain and patch density</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">result</span>, max.level <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></code></pre></div>
<pre><code>## List of 6
##  $ time         : num [1:142] 0e+00 1e-05 2e-05 3e-05 4e-05 ...
##  $ species      :List of 1
##  $ env          :List of 142
##  $ seed_rain    : num 19.8
##  $ patch_density: num [1:142] 0.0333 0.0333 0.0333 0.0333 0.0333 ...
##  $ p            :List of 13
##   ..- attr(*, "class")= chr [1:2] "Parameters&lt;FF16,FF16_Env&gt;" "Parameters"</code></pre>
<p>We‚Äôll explain these latter entries, but for now we focus species and the patch environment. The species object is a N-dimensional array describing each state, for each cohort at each timestep</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">species</span><span class="op">)</span></code></pre></div>
<pre><code>## List of 1
##  $ : num [1:7, 1:142, 1:141] 0.392 0.0107 0 0 0 ...
##   ..- attr(*, "dimnames")=List of 3
##   .. ..$ : chr [1:7] "height" "mortality" "fecundity" "area_heartwood" ...
##   .. ..$ : NULL
##   .. ..$ : NULL</code></pre>
<p>Let‚Äôs look at height. Each line represents the height of a cohort of individuals over time, beginning from the point at which the cohort recruited into the patch. Notably, the first cohorts follow much the same growth curve as our individual above, but subsequent cohorts have a bumpier ride, with growth slowing as the canopy closes over</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">t</span> <span class="op">&lt;-</span> <span class="va">result</span><span class="op">$</span><span class="va">time</span>
<span class="va">h</span> <span class="op">&lt;-</span> <span class="va">result</span><span class="op">$</span><span class="va">species</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="st">"height"</span>, , <span class="op">]</span>

<span class="fu"><a href="https://rdrr.io/r/graphics/matplot.html">matplot</a></span><span class="op">(</span><span class="va">t</span>, <span class="va">h</span>, lty<span class="op">=</span><span class="fl">1</span>, col<span class="op">=</span><span class="fu"><a href="../reference/make_transparent.html">make_transparent</a></span><span class="op">(</span><span class="st">"black"</span>, <span class="fl">0.25</span><span class="op">)</span>, type<span class="op">=</span><span class="st">"l"</span>,
        las<span class="op">=</span><span class="fl">1</span>, xlab<span class="op">=</span><span class="st">"Time (years)"</span>, ylab<span class="op">=</span><span class="st">"Height (m)"</span><span class="op">)</span></code></pre></div>
<p><img src="figure/plant__unnamed-chunk-13-1.png"> To see the change in canopy opennes over time we can explore the patch Environment. Lets look at year 20 first, which corresponds to the 99th timestep in our model (not all timesteps are equal!) Our FF16 environment is described in terms of canopy openness, with 1.0 being completely open and 0.0 being completely shaded. We see that the shortest cohorts experience intense shading while taller cohorts enjoy full sunlight:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">env</span> <span class="op">&lt;-</span> <span class="va">result</span><span class="op">$</span><span class="va">env</span><span class="op">[[</span><span class="fl">99</span><span class="op">]</span><span class="op">]</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">env</span><span class="op">)</span></code></pre></div>
<p><img src="figure/plant__unnamed-chunk-14-1.png"> If we look at the light environment at the forest floor (height = 0.0) we can see that it varies through time as older cohorts thin out and gaps form</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">env_min</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">env</span>, <span class="kw">function</span><span class="op">(</span><span class="va">e</span><span class="op">)</span> <span class="va">e</span><span class="op">[</span><span class="fl">1</span>, <span class="st">"canopy_openness"</span><span class="op">]</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">t</span>, <span class="va">env_min</span><span class="op">)</span></code></pre></div>
<p><img src="figure/plant__unnamed-chunk-15-1.png"></p>
<p>This suggests that competition is density dependent and that our earlier figure of height over time is incomplete as many individuals will die out before reaching their potential maximum height. The final variable of our species <code>state</code> array is the log density of the cohorts, which we can use to weight the growth trajectories to show thinning</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Relativise the log densities onto (-4, max)</span>
<span class="va">rel</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">xmin</span> <span class="op">=</span> <span class="op">-</span><span class="fl">4</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">x</span><span class="op">[</span><span class="va">x</span> <span class="op">&lt;</span> <span class="va">xmin</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">xmin</span>
  <span class="va">xmax</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">x</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
  <span class="op">(</span><span class="va">x</span> <span class="op">-</span> <span class="va">xmin</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="va">xmax</span> <span class="op">-</span> <span class="va">xmin</span><span class="op">)</span>
<span class="op">}</span>

<span class="va">d</span> <span class="op">&lt;-</span> <span class="va">result</span><span class="op">$</span><span class="va">species</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="st">"log_density"</span>, , <span class="op">]</span>

<span class="va">rd</span> <span class="op">&lt;-</span> <span class="fu">rel</span><span class="op">(</span><span class="va">d</span><span class="op">)</span>

<span class="co"># R doesn't seem to offer a way to plot lines that vary in colour, so</span>
<span class="co"># this is quite roundabout using `segments`, shaded by the density at</span>
<span class="co"># the first part of the line segment:</span>
<span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">t</span><span class="op">)</span>
<span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="va">t</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">h</span><span class="op">)</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">h</span><span class="op">)</span><span class="op">)</span>
<span class="va">col</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="../reference/make_transparent.html">make_transparent</a></span><span class="op">(</span><span class="st">"black"</span>, <span class="va">rd</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">d</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="cn">NA</span>, xlim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/range.html">range</a></span><span class="op">(</span><span class="va">t</span><span class="op">)</span>, ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/range.html">range</a></span><span class="op">(</span><span class="va">h</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>,
     las<span class="op">=</span><span class="fl">1</span>, xlab<span class="op">=</span><span class="st">"Time (years)"</span>, ylab<span class="op">=</span><span class="st">"Cohort height (m)"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/segments.html">segments</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span>, <span class="op">]</span>, <span class="va">h</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span>, <span class="op">]</span>, <span class="va">x</span><span class="op">[</span><span class="op">-</span><span class="va">n</span>, <span class="op">]</span>, <span class="va">h</span><span class="op">[</span><span class="op">-</span><span class="va">n</span>, <span class="op">]</span>, col<span class="op">=</span><span class="va">col</span><span class="op">[</span><span class="op">-</span><span class="va">n</span>, <span class="op">]</span>, lend<span class="op">=</span><span class="st">"butt"</span><span class="op">)</span></code></pre></div>
<p><img src="figure/plant__unnamed-chunk-16-1.png"></p>
</div>
<div id="meta-populations" class="section level1">
<h1 class="hasAnchor">
<a href="#meta-populations" class="anchor"></a>Meta-populations</h1>
<p>üöß Coming soon üöß</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Daniel Falster, Richard FitzJohn, Rafael Schouten, Andrew O'Reilly-Nugent.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
